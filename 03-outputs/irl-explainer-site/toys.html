<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Toy Playground — IRL</title>

    <style>
      :root {
        --bg: #ffffff;
        --ink: #111827;
        --muted: #4b5563;
        --subtle: #6b7280;
        --border: #e5e7eb;
        --green: #059669;
        --red: #dc2626;
        --code-bg: #0b1020;
        --code-ink: #e5e7eb;

        --sans: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
        --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
      }

      * { box-sizing: border-box; }

      html, body { height: 100%; }

      body {
        margin: 0;
        background: linear-gradient(180deg, #ffffff 0%, #fbfbfb 70%, #ffffff 100%);
        color: var(--ink);
        font-family: var(--sans);
        line-height: 1.7;
        text-rendering: optimizeLegibility;
      }

      .topbar {
        position: sticky;
        top: 0;
        z-index: 50;
        background: rgba(255, 255, 255, 0.82);
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid var(--border);
      }
      .topbar-inner {
        max-width: 860px;
        margin: 0 auto;
        padding: 12px 18px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }
      .brand {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        font-weight: 650;
        color: var(--ink);
        text-decoration: none;
        letter-spacing: -0.01em;
      }
      .brand svg {
        width: 14px;
        height: 14px;
        display: block;
      }
      .topbar a.util {
        font-family: var(--mono);
        font-size: 12px;
        color: var(--subtle);
        text-decoration: none;
      }
      .topbar a.util:hover {
        color: var(--ink);
      }

      .wrap {
        max-width: 860px;
        margin: 0 auto;
        padding: 28px 18px 80px;
      }

      header {
        padding: 26px 0 22px;
        border-bottom: 1px solid var(--border);
        text-align: center;
      }

      h1 {
        font-size: clamp(28px, 3.5vw, 40px);
        line-height: 1.1;
        letter-spacing: -0.02em;
        margin: 0 0 8px;
      }

      .subtitle {
        font-family: var(--mono);
        font-size: 13px;
        color: var(--subtle);
      }

      p { margin: 12px 0; }

      h2 {
        font-size: 22px;
        line-height: 1.25;
        letter-spacing: -0.01em;
        margin: 28px 0 10px;
        padding-bottom: 6px;
        border-bottom: 1px solid var(--border);
      }

      .intro {
        color: var(--muted);
        font-size: 16px;
        max-width: 600px;
        margin: 16px auto;
        text-align: center;
      }

      /* Side-by-side contrast layout */
      .contrast {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-top: 18px;
      }
      @media (max-width: 600px) {
        .contrast {
          grid-template-columns: 1fr;
        }
      }

      .panel {
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 16px;
        background: #ffffff;
      }

      .panel-title {
        font-family: var(--mono);
        font-size: 12px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        margin: 0 0 12px;
      }
      .panel-title.good { color: var(--green); }
      .panel-title.bad { color: var(--red); }

      .panel button {
        font-family: var(--mono);
        font-size: 12px;
        padding: 8px 12px;
        border-radius: 8px;
        border: 1px solid var(--border);
        background: #ffffff;
        cursor: pointer;
      }
      .panel button:hover { background: #f9fafb; }

      .run-count {
        font-family: var(--mono);
        font-size: 12px;
        color: var(--subtle);
        margin-left: 10px;
      }

      .file-display {
        margin-top: 12px;
        border: 1px solid var(--border);
        border-radius: 8px;
        background: #fafafa;
        font-family: var(--mono);
        font-size: 12.5px;
        line-height: 1.6;
        overflow: hidden;
      }

      .file-header {
        padding: 6px 10px;
        background: #f3f4f6;
        border-bottom: 1px solid var(--border);
        font-size: 11px;
        color: var(--subtle);
      }

      .file-body {
        padding: 10px 12px;
        min-height: 60px;
        white-space: pre-wrap;
      }

      .diff-status {
        margin-top: 10px;
        padding: 8px 10px;
        border-radius: 8px;
        font-family: var(--mono);
        font-size: 12px;
        line-height: 1.5;
      }
      .diff-status.clean {
        background: #f0fdf4;
        border: 1px solid #bbf7d0;
        color: var(--green);
      }
      .diff-status.dirty {
        background: #fef2f2;
        border: 1px solid #fecaca;
        color: var(--red);
      }
      .diff-status.empty {
        background: #f9fafb;
        border: 1px solid var(--border);
        color: var(--subtle);
      }

      .aside {
        border-left: 3px solid var(--border);
        padding-left: 14px;
        margin: 18px 0;
        color: var(--muted);
        font-size: 15px;
      }

      footer {
        margin-top: 28px;
        padding-top: 18px;
        border-top: 1px solid var(--border);
        color: var(--subtle);
        font-size: 13px;
      }

      a {
        color: var(--ink);
        text-decoration: underline;
        text-underline-offset: 2px;
        text-decoration-thickness: 1px;
      }
      a:hover { text-decoration: none; }
      a:focus-visible, button:focus-visible {
        outline: 2px solid var(--ink);
        outline-offset: 2px;
      }
    </style>
  </head>
  <body>
    <header class="topbar">
      <div class="topbar-inner">
        <a class="brand" href="index.html" aria-label="Back to explainer">
          <svg viewBox="0 0 16 16" aria-hidden="true">
            <circle cx="8" cy="8" r="6" fill="none" stroke="currentColor" stroke-width="1.5"></circle>
            <circle cx="8" cy="8" r="2" fill="currentColor"></circle>
          </svg>
          IRL Toys
        </a>
        <a class="util" href="index.html">Back to Explainer</a>
      </div>
    </header>

    <div class="wrap">
      <header>
        <h1>Toy Playground</h1>
        <div class="subtitle">Design experiments for IRL concepts</div>
      </header>

      <h2>Idempotent vs. Non-Idempotent</h2>
      <p class="intro">
        Click "Run Step" on each side and watch what happens. One side produces
        the same result every time. The other doesn't.
      </p>

      <div class="contrast">
        <!-- Idempotent panel -->
        <div class="panel">
          <div class="panel-title good">Idempotent</div>
          <button id="idem-btn" type="button">Run Step</button>
          <span id="idem-count" class="run-count"></span>

          <div id="idem-file" class="file-display" style="display:none">
            <div class="file-header">03-outputs/report.html</div>
            <div class="file-body" id="idem-body"></div>
          </div>

          <div id="idem-diff" class="diff-status empty">
            Press "Run Step" to begin.
          </div>
        </div>

        <!-- Non-idempotent panel -->
        <div class="panel">
          <div class="panel-title bad">Non-Idempotent</div>
          <button id="nonidem-btn" type="button">Run Step</button>
          <span id="nonidem-count" class="run-count"></span>

          <div id="nonidem-file" class="file-display" style="display:none">
            <div class="file-header" id="nonidem-header">03-outputs/report.html</div>
            <div class="file-body" id="nonidem-body"></div>
          </div>

          <div id="nonidem-diff" class="diff-status empty">
            Press "Run Step" to begin.
          </div>
        </div>
      </div>

      <p class="aside">
        The left side is safe to rerun: same inputs, same output, empty diff.
        The right side accumulates mess: timestamped filenames, drifting data,
        diffs that grow with every run. Idempotency is what makes the loop
        trustworthy.
      </p>

      <footer>
        <a href="index.html">Back to the explainer</a>
      </footer>
    </div>

    <script>
      (function () {
        // ── Idempotent side ──
        var iBtn = document.getElementById("idem-btn");
        var iCount = document.getElementById("idem-count");
        var iFile = document.getElementById("idem-file");
        var iBody = document.getElementById("idem-body");
        var iDiff = document.getElementById("idem-diff");
        var iRuns = 0;

        var stableOutput = "Subjects: 42\nMean age: 11.3\np = 0.023";

        iBtn.addEventListener("click", function () {
          iRuns++;
          iCount.textContent = "Run #" + iRuns;
          iFile.style.display = "";
          iBody.textContent = stableOutput;

          if (iRuns === 1) {
            iDiff.className = "diff-status clean";
            iDiff.textContent = "Output written to 03-outputs/report.html";
          } else {
            iDiff.className = "diff-status clean";
            iDiff.textContent =
              "git diff: (empty) — no changes. Run #" + iRuns +
              " produced the same file.";
          }
        });

        // ── Non-idempotent side ──
        var nBtn = document.getElementById("nonidem-btn");
        var nCount = document.getElementById("nonidem-count");
        var nFile = document.getElementById("nonidem-file");
        var nHeader = document.getElementById("nonidem-header");
        var nBody = document.getElementById("nonidem-body");
        var nDiff = document.getElementById("nonidem-diff");
        var nRuns = 0;
        var nFiles = [];

        function fakeTimestamp(run) {
          // Simulate different timestamps for each run
          var base = 1422 + run;
          return "2026-02-08_" + base;
        }

        nBtn.addEventListener("click", function () {
          nRuns++;
          nCount.textContent = "Run #" + nRuns;
          nFile.style.display = "";

          var ts = fakeTimestamp(nRuns);
          var filename = "report_" + ts + ".html";
          nFiles.push(filename);

          nHeader.textContent = "03-outputs/" + filename;

          // Slightly different data each run (simulating nondeterminism)
          var ages = [11.3, 11.4, 11.2, 11.5, 11.1];
          var pvals = [0.023, 0.027, 0.019, 0.031, 0.024];
          var idx = (nRuns - 1) % ages.length;

          nBody.textContent =
            "Subjects: 42\n" +
            "Mean age: " + ages[idx] + "\n" +
            "p = " + pvals[idx] + "\n" +
            "Generated: " + ts;

          if (nRuns === 1) {
            nDiff.className = "diff-status dirty";
            nDiff.textContent =
              "New file: 03-outputs/" + filename;
          } else {
            nDiff.className = "diff-status dirty";
            nDiff.textContent =
              nFiles.length + " files in 03-outputs/. " +
              "New: " + filename + ". " +
              "Data changed (age: " + ages[idx] +
              ", p: " + pvals[idx] + "). Which one is correct?";
          }
        });
      })();
    </script>
  </body>
</html>
